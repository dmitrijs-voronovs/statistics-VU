---
title: "R Notebook"
output: html_notebook
---

## Exercise 3

### a)

<!--# a)  Study the data and give a few (>1) summaries (graphics or tables). Fit a logistic regression model (no interactions yet) to investigate the association between the survival status and the predictors PClass, Age and Sex. Interpret the results in terms of odds, comment. -->

```{r}
titanic = read.table("titanic.txt", header = T)
```

```{r}
survived = factor(titanic$Survived, c('0', '1'), c('no', 'yes'))
plot(survived ~ factor(titanic$PClass), main='Ratio of survivors per class', xlab='Passenger class', ylab='survived')
```

The graph shows that the higher the passenger class, the bigger
percentage or survivors.

```{r}
plot(survived, factor(titanic$PClass), main='Ration of survivors per class', ylab='Passenger class', xlab='survived')
```

Also the higher the passenger class, the more survivors.

```{r}
plot(factor(titanic$Sex), survived, main='Ratio of survivors per sex', xlab='sex', ylab='survived')
```

And that in total there are more female survivors then male survivors.

```{r}
par(mfrow=c(1,2))
hist(titanic$Age, breaks = seq(0, 80, 5), main='Age of all', xlab='Age')
plot(survived ~ titanic$Age, main='Ratio of survival per Age', xlab='age', ylab='survived')
par(mfrow=c(1,1))
```

The most people were between the ages of 15 and 30, but the age group
under 5 has the highest survival rate.

```{r}
titanic = read.table("titanic.txt", header = T)
titanic$Sex <- factor(titanic$Sex, levels=c("male", "female"), labels=c(1, 0))
titanic$PClass <- factor(titanic$PClass,levels=c("1st", "2nd", "3rd"), labels=c(1, 2, 3))
titanic$Survived <- factor(titanic$Survived)
titanic


model <- glm(Survived ~ PClass + Age + Sex, data=titanic, family=binomial(link="logit"))
summary(model)
```

```{r}
odds_ratio <- exp(coef(model))
odds_ratio <- data.frame(feature=names(odds_ratio), odds_ratio=odds_ratio)
odds_ratio
```
The odds ratios for PClass2 and PClass3 are calculated based on the reference category of PClass1. 
The odds ratio for PClass2 of 0.275 means that the odds of survival for a passenger in second class are 0.275 times the odds of survival for a passenger in the reference category of PClass1. This suggests that passengers in second class were less likely to survive than passengers in first class, holding the other variables constant.
Similarly, the odds ratio for PClass3 of 0.080 means that the odds of survival for a passenger in third class are 0.080 times the odds of survival for a passenger in the reference category of PClass1 (first class), holding the other variables constant.
The odds ratio for Age is 0.965, which means that for each one-year increase in age, the odds of survival decrease by a factor of about 0.965, holding the other variables constant.
The odds ratio for Sex0 is 13.8926071, which means that the odds of survival for a female passenger are about 13.8926071 times the odds of survival for a male passenger, holding the other variables constant. This suggests that female passengers were more likely to survive than male passengers.

Overall, the results suggest that female passengers and those in higher classes (i.e. first and second class) were more likely to survive than male passengers and those in third class. Age was also a significant predictor, with older passengers being less likely to survive than younger passengers.

### b)
<!--#Investigate the interaction of predictor Age with PClass, and the interaction of Age with Sex. From this and a), choose (and justify) a resulting model. For this model, report the estimate for the probability of survival for each combination of levels of the factors PClass and Sex for a person of age 55.-->

```{r}
model <- glm(Survived ~ PClass + Age + Sex + Age:PClass + Age:Sex, data=titanic, family=binomial(link="logit"))
summary(model)
```
To choose the resulting model, we need to evaluate the statistical significance of the interaction terms. If they are not significant, we can stick with the original model without the interaction terms.
In the summary output, the p-values for the interaction terms PClass2:Age and Age:Sex0 are 0.04012 and 1.52e-06, respectively. Both of these p-values are less than 0.05, which suggests that the interactions are significant. Therefore, it is appropriate to include the interaction terms in the model.

Once we have our final model, we can use it to estimate the probability of survival for each combination of levels of the factors PClass and Sex for a person of age 55. 

```{r}
newdata <- expand.grid(PClass=levels(titanic$PClass), Sex=levels(titanic$Sex))
newdata$Age <- rep(55, nrow(newdata))

# use the predict() function to get the predicted probabilities for each combination of PClass, Sex, and Age
newdata$SurvivalProb <- predict(model, newdata, type="response")

newdata
```
As we can see, indeed the highest probability of the survival denotes to the female passenger of the 1st class, while the lowest - to male passenger of the 3rd class.


### c)

<!--# c) Propose a method to predict the survival status and a quality measure for your prediction and describe how you would implement that method (you do not need to implement it). -->

One method to predict the survival status is to use the final model
**tlm** and apply it to new data containing the predictor variables for
each passenger. Moreover, we can divide the dataset into training and
testing sets. The training set is then used to train a logistic
regression model, which is then used to predict the survival status of
the testing set. We compute metrics such as accuracy and precision to
evaluate the model's performance. This process is repeated until we find
the best-performing model, which we can use to predict the survival
status of new passengers based on their characteristics.


Predict the survival status:

```{r}
# split the dataset into training and testing sets
library(caTools)
set.seed(42)
split <- sample.split(titanic$Survived, SplitRatio=0.8)
train <- subset(titanic, split==TRUE)
test <- subset(titanic, split==FALSE)
```
<!--# TODO !!!! -->



### d)

### e)
